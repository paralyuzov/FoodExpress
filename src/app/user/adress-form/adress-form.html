<div class="p-6 max-w-2xl mx-auto relative">
  <!-- Close button -->
  <button
    type="button"
    (click)="closeDialog()"
    class="absolute top-4 right-4 z-10 w-8 h-8 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 rounded-full flex items-center justify-center transition-colors duration-200 group"
    aria-label="Close dialog"
  >
    <i class="pi pi-times text-slate-600 dark:text-slate-300 group-hover:text-slate-800 dark:group-hover:text-slate-100 text-sm"></i>
  </button>

  <div class="space-y-6">
    @if(addresses(); as addressList) {
      @if(orderError(); as orderError) {
      <div class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-200 dark:bg-red-700 dark:text-red-300" role="alert">
        <i class="pi pi-exclamation-triangle mr-2"></i>
        {{ orderError }}
      </div>
      }
    <div class="space-y-4">
      <div class="flex items-center gap-3 mb-4">
        <div
          class="w-6 h-6 bg-gradient-to-r from-amber-400 to-yellow-500 rounded-lg flex items-center justify-center"
        >
          <i class="pi pi-map-marker text-slate-900 text-xs"></i>
        </div>
        <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Choose Address</h3>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-64 overflow-y-auto">
        @for(address of addressList; track address.id) {
        <label class="block cursor-pointer group">
          <div
            class="relative p-3 rounded-lg border-[1px] border-slate-600 transition-all duration-200 h-full"
            [class.dark:border-amber-400]="isAddressSelected(address.id)"
          >
            <input
              type="radio"
              name="selectedAddress"
              [value]="address.id"
              (change)="onAddressSelect(address.id)"
              [checked]="isAddressSelected(address.id)"
              class="absolute top-3 right-3 w-4 h-4 text-amber-500 border-slate-300 dark:border-slate-600"
            />

            <div class="pr-6 space-y-2">
              <div class="flex items-center gap-2">
                <i class="pi pi-building text-amber-500 text-sm"></i>
                <span class="text-slate-800 dark:text-white font-medium text-sm truncate">{{ address.country }}</span>
              </div>

              <div class="space-y-1 text-xs">
                <div class="flex items-center gap-1">
                  <i class="pi pi-map text-slate-500 dark:text-slate-400"></i>
                  <span class="text-slate-600 dark:text-slate-300 truncate">{{ address.state }}, {{ address.city }}</span>
                </div>
                <div class="flex items-center gap-1">
                  <i class="pi pi-home text-slate-500 dark:text-slate-400"></i>
                  <span class="text-slate-600 dark:text-slate-300 truncate">{{ address.street }}</span>
                </div>
                <div class="text-slate-500 dark:text-slate-400 text-xs">{{ address.zipCode }}</div>
              </div>
            </div>
            </div>
          </label>
          }
          <button
            (click)="onAddNewAddress()"
            class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-medium py-2.5 px-4 rounded-lg transition-all duration-200 text-sm"
          >
            <i class="pi pi-plus text-sm"></i>
            Add New Address
          </button>
        </div>
      </div>
      }

      @if(selectAddNewAddress()) {
      <div class="border-t border-slate-200 dark:border-slate-600 pt-6">
        <div class="flex items-center gap-3 mb-4">
          <div
            class="w-6 h-6 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"
          >
            <i class="pi pi-plus text-white text-xs"></i>
          </div>
          <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Add New Address</h3>
        </div>

        <form [formGroup]="addressForm" (ngSubmit)="onSubmit()" class="space-y-4">
          <div class="space-y-2">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">
              <i class="pi pi-globe text-amber-500 mr-2"></i>
              Country
            </label>
            <div class="relative">
              <p-select
                formControlName="country"
                inputId="dd-country"
                optionValue="code"
                [options]="countries"
                optionLabel="name"
                placeholder="Select your country"
                class="w-full"
                [style]="{ width: '100%' }"
              />
            </div>
            @if(isInvalid('country')) {
            <div class="flex items-center gap-2 mt-1">
              <i class="pi pi-exclamation-triangle text-red-500 text-xs"></i>
              <span class="text-red-500 text-sm">{{ getErrorMessage('country') }}</span>
            </div>
            }
          </div>

          <div class="space-y-2">
            <label for="state" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
              <i class="pi pi-map text-amber-500 mr-2"></i>
              State / Province
            </label>
            <div class="relative">
              <input
                pInputText
                id="state"
                formControlName="state"
                autocomplete="address-level1"
                placeholder="Enter your state or province"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 transition-all duration-200"
              />
            </div>
            @if(isInvalid('state')) {
            <div class="flex items-center gap-2 mt-1">
              <i class="pi pi-exclamation-triangle text-red-500 text-xs"></i>
              <span class="text-red-500 text-sm">{{ getErrorMessage('state') }}</span>
            </div>
            }
          </div>

          <div class="space-y-2">
            <label for="city" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
              <i class="pi pi-building text-amber-500 mr-2"></i>
              City
            </label>
            <div class="relative">
              <input
                pInputText
                id="city"
                formControlName="city"
                autocomplete="address-level2"
                placeholder="Enter your city"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 transition-all duration-200"
              />
            </div>
            @if(isInvalid('city')) {
            <div class="flex items-center gap-2 mt-1">
              <i class="pi pi-exclamation-triangle text-red-500 text-xs"></i>
              <span class="text-red-500 text-sm">{{ getErrorMessage('city') }}</span>
            </div>
            }
          </div>

          <div class="space-y-2">
            <label for="zipCode" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
              <i class="pi pi-hashtag text-amber-500 mr-2"></i>
              Zip / Postal Code
            </label>
            <div class="relative">
              <input
                pInputText
                id="zipCode"
                formControlName="zipCode"
                autocomplete="postal-code"
                placeholder="Enter your zip or postal code"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 transition-all duration-200"
              />
            </div>
            @if(isInvalid('zipCode')) {
            <div class="flex items-center gap-2 mt-1">
              <i class="pi pi-exclamation-triangle text-red-500 text-xs"></i>
              <span class="text-red-500 text-sm">{{ getErrorMessage('zipCode') }}</span>
            </div>
            }
          </div>

          <div class="space-y-2">
            <label for="street" class="block text-sm font-medium text-slate-700 dark:text-slate-300">
              <i class="pi pi-home text-amber-500 mr-2"></i>
              Street Address
            </label>
            <div class="relative">
              <input
                pInputText
                id="street"
                formControlName="street"
                autocomplete="street-address"
                placeholder="Enter your street address"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 transition-all duration-200"
              />
            </div>
            @if(isInvalid('street')) {
            <div class="flex items-center gap-2 mt-1">
              <i class="pi pi-exclamation-triangle text-red-500 text-xs"></i>
              <span class="text-red-500 text-sm">{{ getErrorMessage('street') }}</span>
            </div>
            }
          </div>

          <div class="pt-4">
            <button
              type="submit"
              [disabled]="addressForm.invalid"
              class="w-full bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 disabled:from-slate-400 disabled:to-slate-500 text-white disabled:text-slate-300 font-medium py-2.5 px-4 rounded-lg transition-all duration-200 disabled:cursor-not-allowed text-sm"
            >
              Add Address
            </button>
          </div>
        </form>
      </div>
      }

    <!-- Continue to Checkout Button -->
    <div class="pt-6 border-t border-slate-200 dark:border-slate-600">
      <button
        type="button"
        (click)="proceedToCheckout()"
        [disabled]="selectedAddressId() === null"
        class="w-full group relative overflow-hidden bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-600 hover:to-yellow-600 disabled:from-slate-600 disabled:to-slate-700 disabled:cursor-not-allowed text-slate-900 disabled:text-slate-400 font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-[1.02] disabled:hover:scale-100 shadow-lg hover:shadow-xl"
      >
        <span class="flex items-center justify-center gap-2">
          <i class="pi pi-arrow-right"></i>
          Continue to Checkout
        </span>
      </button>
    </div>
  </div>
</div>
