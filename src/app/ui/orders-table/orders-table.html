@if(isOrderLoading()) {
<div class="flex justify-center items-center min-h-[50vh] font-pt-sans">
  <div class="text-center space-y-4">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-400 mx-auto"></div>
    <p class="text-slate-300">Loading orders...</p>
  </div>
</div>
} @else {
  <div class="orders-table-container font-pt-sans ">
  <p-table
    [value]="orders()"
    dataKey="id"
    [expandedRowKeys]="expandedRows"
    class="p-datatable-gridlines!"
    [tableStyle]="{ 'min-width': '60rem' }"
    size="small"
  >
    <ng-template #caption>
      <div class="flex flex-wrap justify-end gap-2 mb-4">
        <p-button
          label="Expand All"
          icon="pi pi-plus"
          [text]="true"
          (onClick)="expandAll()"
          styleClass="text-neutral-400!"
        />
        <p-button
          label="Collapse All"
          icon="pi pi-minus"
          [text]="true"
          (onClick)="collapseAll()"
          styleClass="text-neutral-400!"
        />
      </div>
    </ng-template>

    <ng-template #header>
      <tr class="bg-neutral-800">
        <th style="width: 3rem" class="text-amber-300"></th>
        <th class="text-amber-300! font-mono!">Order #</th>
        <th class="text-amber-300! font-semibold">Restaurant</th>
        <th class="text-amber-300! font-semibold">Status</th>
        <th class="text-amber-300! font-semibold">Date</th>
        <th class="text-amber-300! font-semibold">Items</th>
        <th class="text-amber-300! font-semibold">Total</th>
      </tr>
    </ng-template>

    <ng-template #body let-order let-expanded="expanded">
      <tr class="bg-neutral-900 hover:bg-neutral-800 border-b border-slate-700">
        <td>
          <p-button
            type="button"
            [pRowToggler]="order"
            [text]="true"
            severity="secondary"
            [rounded]="true"
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
            class="text-amber-400"
          />
        </td>
        <td class="text-white font-mono text-sm tracking-wide">
          {{ order.id.slice(-8).toUpperCase() }}
        </td>
        <td class="text-white">
          <div class="flex items-center gap-3">
            <img
              [src]="order.restaurant.imageUrl"
              [alt]="order.restaurant.name"
              class="w-14 h-14 rounded-lg object-cover flex-shrink-0"
            />
            <span class="font-medium">{{ order.restaurant.name }}</span>
          </div>
        </td>
        <td>
          <p-tag [value]="order.status | removeUnderscore" [severity]="getStatusSeverity(order.status)"></p-tag>
        </td>
        <td class="text-slate-300">
          <div class="text-sm">
            <div>{{ order.createdAt | date : 'MMM dd, yyyy' }}</div>
            <div class="text-slate-400">{{ order.createdAt | date : 'HH:mm' }}</div>
          </div>
        </td>
        <td class="text-slate-300">
          <span class="bg-neutral-700 text-amber-300 px-2 py-1 rounded-full text-xs font-semibold">
            {{ order.items.length }} item{{ order.items.length !== 1 ? 's' : '' }}
          </span>
        </td>
        <td class="text-white font-bold">${{ order.total }}</td>
      </tr>
    </ng-template>

    <ng-template #expandedrow let-order>
      <tr class="bg-gradient-to-t! from-neutral-800/60! to-neutral-900!">
        <td colspan="7" class="rounded-b-xl! border-x-2! border-neutral-900!">
          <div class="p-6">
            <div class="mb-6">
              <h3 class="text-xl  text-white mb-2">Order Details</h3>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                <div class="bg-neutral-900/50 border border-neutral-700 rounded-lg p-3">
                  <div class="text-slate-400">Subtotal</div>
                  <div class="text-white font-semibold">${{ order.subtotal }}</div>
                </div>
                <div class="bg-neutral-900/50 border border-neutral-700 rounded-lg p-3">
                  <div class="text-slate-400">Delivery Fee</div>
                  <div class="text-white font-semibold">${{ order.deliveryFee }}</div>
                </div>
                <div class="bg-neutral-900/50 border border-neutral-700 rounded-lg p-3">
                  <div class="text-slate-400">Tax</div>
                  <div class="text-white font-semibold">${{ order.tax }}</div>
                </div>
                <div class="bg-neutral-900/50 border border-neutral-700 rounded-lg p-3">
                  <div class="text-slate-400">Est. Time</div>
                  <div class="text-white font-semibold">{{ order.estimatedTime }} min</div>
                </div>
              </div>
            </div>

            <div>
              <h4 class="text-lg  text-white mb-4">
                Items Ordered ({{ order.items?.length || 0 }} items)
              </h4>

              @if (order.items && order.items.length > 0) {
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                @for (item of order.items; track item.id) {
                <div
                  class="bg-neutral-900/50 rounded-xl p-4 border border-neutral-700/80"
                >
                  <div class="flex items-center gap-4">
                    <img
                      [src]="item.dish.imageUrl"
                      [alt]="item.dish.name"
                      class="w-20 h-20 rounded-lg object-cover flex-shrink-0"
                    />
                    <div class="flex-1 min-w-0">
                      <h5 class="font-semibold text-white text-sm mb-1 truncate">
                        {{ item.dish.name }}
                      </h5>
                      <div class="flex items-center justify-between">
                        <span class="text-slate-400 text-sm"> Qty: {{ item.quantity }} </span>
                        <span class="text-amber-400 font-bold"> ${{ item.price }} </span>
                      </div>
                      <div class="text-xs text-slate-500 mt-1">
                        Total: ${{ (+item.price * +item.quantity).toFixed(2) }}
                      </div>
                    </div>
                  </div>
                </div>
                }
              </div>
              }
            </div>

            <div class="mt-6 flex flex-wrap gap-3">

              <button
                (click)="onViewDetails(order)"
                class="px-4 py-2 bg-amber-300 hover:bg-amber-400 text-neutral-700 rounded-lg transition-colors duration-200"
              >
                <i class="pi pi-info-circle mr-2"></i>
                Details
              </button>

            </div>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
}

